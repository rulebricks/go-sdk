// Code generated by Fern. DO NOT EDIT.

package client

import (
	context "context"
	sdk "sdk"
	admin "sdk/contexts/admin"
	relationships "sdk/contexts/relationships"
	core "sdk/core"
	internal "sdk/internal"
	option "sdk/option"
)

type Client struct {
	WithRawResponse *RawClient
	Admin           *admin.Client
	Relationships   *relationships.Client

	options *core.RequestOptions
	baseURL string
	caller  *internal.Caller
}

func NewClient(options *core.RequestOptions) *Client {
	return &Client{
		Admin:           admin.NewClient(options),
		Relationships:   relationships.NewClient(options),
		WithRawResponse: NewRawClient(options),
		options:         options,
		baseURL:         options.BaseURL,
		caller: internal.NewCaller(
			&internal.CallerParams{
				Client:      options.HTTPClient,
				MaxAttempts: options.MaxAttempts,
			},
		),
	}
}

// Retrieve the current state of a context instance.
func (c *Client) GetInstance(
	ctx context.Context,
	request *sdk.GetInstanceContextsRequest,
	opts ...option.RequestOption,
) (*sdk.ContextInstanceState, error) {
	response, err := c.WithRawResponse.GetInstance(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}

// Submit data to a context instance, creating it if it doesn't exist. May trigger bound rule/flow evaluations.
func (c *Client) Submit(
	ctx context.Context,
	request *sdk.SubmitContextsRequest,
	opts ...option.RequestOption,
) (*sdk.SubmitContextDataResponse, error) {
	response, err := c.WithRawResponse.Submit(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}

// Delete a specific context instance and its history.
func (c *Client) DeleteInstance(
	ctx context.Context,
	request *sdk.DeleteInstanceContextsRequest,
	opts ...option.RequestOption,
) (*sdk.DeleteContextInstanceResponse, error) {
	response, err := c.WithRawResponse.DeleteInstance(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}

// Retrieve the change history for a context instance.
func (c *Client) GetHistory(
	ctx context.Context,
	request *sdk.GetHistoryContextsRequest,
	opts ...option.RequestOption,
) (*sdk.ContextInstanceHistory, error) {
	response, err := c.WithRawResponse.GetHistory(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}

// Get list of rules/flows that need to be evaluated for this instance.
func (c *Client) GetPending(
	ctx context.Context,
	request *sdk.GetPendingContextsRequest,
	opts ...option.RequestOption,
) (*sdk.ContextInstancePendingResponse, error) {
	response, err := c.WithRawResponse.GetPending(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}

// Execute a specific rule using the context instance's state as input.
func (c *Client) Solve(
	ctx context.Context,
	request *sdk.SolveContextRuleRequest,
	opts ...option.RequestOption,
) (*sdk.SolveContextRuleResponse, error) {
	response, err := c.WithRawResponse.Solve(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}

// Trigger re-evaluation of all bound rules and flows for the instance.
func (c *Client) Cascade(
	ctx context.Context,
	request *sdk.CascadeContextRequest,
	opts ...option.RequestOption,
) (*sdk.CascadeContextResponse, error) {
	response, err := c.WithRawResponse.Cascade(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}

// Execute a specific flow using the context instance's state as input.
func (c *Client) Execute(
	ctx context.Context,
	request *sdk.SolveContextFlowRequest,
	opts ...option.RequestOption,
) (*sdk.SolveContextFlowResponse, error) {
	response, err := c.WithRawResponse.Execute(
		ctx,
		request,
		opts...,
	)
	if err != nil {
		return nil, err
	}
	return response.Body, nil
}
